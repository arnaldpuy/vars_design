\PassOptionsToPackage{unicode=true}{hyperref} % options for packages loaded elsewhere
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[11pt,]{article}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e} % provides \textsubscript
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provides euro and other symbols
\else % if luatex or xelatex
  \usepackage{unicode-math}
  \defaultfontfeatures{Ligatures=TeX,Scale=MatchLowercase}
\fi
% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
% use microtype if available
\IfFileExists{microtype.sty}{%
\usepackage[]{microtype}
\UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\IfFileExists{parskip.sty}{%
\usepackage{parskip}
}{% else
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
}
\usepackage{hyperref}
\hypersetup{
            pdftitle={Is VARS more intuitive and efficient than Sobol' indices?},
            pdfauthor={Arnald Puy},
            pdfborder={0 0 0},
            breaklinks=true}
\urlstyle{same}  % don't use monospace font for urls
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
\setlength{\emergencystretch}{3em}  % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}
% Redefines (sub)paragraphs to behave more like sections
\ifx\paragraph\undefined\else
\let\oldparagraph\paragraph
\renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
\let\oldsubparagraph\subparagraph
\renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi

% set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother

\usepackage[font=footnotesize]{caption}
\usepackage{dirtytalk}
\usepackage{booktabs}
\usepackage{tabulary}
\usepackage{enumitem}
\usepackage{lmodern}
\usepackage[T1]{fontenc}
\usepackage{amsfonts}
\usepackage{etoolbox}
\makeatletter
\providecommand{\subtitle}[1]{% add subtitle to \maketitle
  \apptocmd{\@title}{\par {\large #1 \par}}{}{}
}
\makeatother

\title{Is VARS more intuitive and efficient than Sobol' indices?}
\providecommand{\subtitle}[1]{}
\subtitle{R code}
\author{Arnald Puy}
\date{}

\begin{document}
\maketitle

\newpage

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# PRELIMINARY FUNCTIONS ----------------------------------------------------------}

\CommentTok{# Function to read in all required packages in one go:}
\NormalTok{loadPackages <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x) \{}
  \ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in}\NormalTok{ x) \{}
    \ControlFlowTok{if}\NormalTok{(}\OperatorTok{!}\KeywordTok{require}\NormalTok{(i, }\DataTypeTok{character.only =} \OtherTok{TRUE}\NormalTok{)) \{}
      \KeywordTok{install.packages}\NormalTok{(i, }\DataTypeTok{dependencies =} \OtherTok{TRUE}\NormalTok{)}
      \KeywordTok{library}\NormalTok{(i, }\DataTypeTok{character.only =} \OtherTok{TRUE}\NormalTok{)}
\NormalTok{    \}}
\NormalTok{  \}}
\NormalTok{\}}

\CommentTok{# Install development version of sensobol}
\NormalTok{remotes}\OperatorTok{::}\KeywordTok{install_github}\NormalTok{(}\StringTok{"arnaldpuy/sensobol"}\NormalTok{)}

\CommentTok{# Load the packages}
\KeywordTok{loadPackages}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{"tidyverse"}\NormalTok{, }\StringTok{"sensobol"}\NormalTok{, }\StringTok{"data.table"}\NormalTok{, }\StringTok{"parallel"}\NormalTok{, }
               \StringTok{"foreach"}\NormalTok{, }\StringTok{"doParallel"}\NormalTok{, }\StringTok{"pcaPP"}\NormalTok{, }\StringTok{"scales"}\NormalTok{, }
               \StringTok{"cowplot"}\NormalTok{, }\StringTok{"logitnorm"}\NormalTok{, }\StringTok{"benchmarkme"}\NormalTok{, }\StringTok{"Rfast"}\NormalTok{))}

\CommentTok{# Create custom theme}
\NormalTok{theme_AP <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{() \{}
  \KeywordTok{theme_bw}\NormalTok{() }\OperatorTok{+}
\StringTok{    }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{panel.grid.major =} \KeywordTok{element_blank}\NormalTok{(),}
          \DataTypeTok{panel.grid.minor =} \KeywordTok{element_blank}\NormalTok{(),}
          \DataTypeTok{legend.background =} \KeywordTok{element_rect}\NormalTok{(}\DataTypeTok{fill =} \StringTok{"transparent"}\NormalTok{,}
                                           \DataTypeTok{color =} \OtherTok{NA}\NormalTok{),}
          \DataTypeTok{legend.key =} \KeywordTok{element_rect}\NormalTok{(}\DataTypeTok{fill =} \StringTok{"transparent"}\NormalTok{,}
                                    \DataTypeTok{color =} \OtherTok{NA}\NormalTok{))}
\NormalTok{\}}

\CommentTok{# Set checkpoint}
\KeywordTok{dir.create}\NormalTok{(}\StringTok{".checkpoint"}\NormalTok{)}
\KeywordTok{library}\NormalTok{(}\StringTok{"checkpoint"}\NormalTok{)}

\KeywordTok{checkpoint}\NormalTok{(}\StringTok{"2020-07-26"}\NormalTok{, }
           \DataTypeTok{R.version =}\StringTok{"3.6.3"}\NormalTok{, }
           \DataTypeTok{checkpointLocation =} \KeywordTok{getwd}\NormalTok{())}
\end{Highlighting}
\end{Shaded}

\hypertarget{figures}{%
\section{Figures}\label{figures}}

\newpage

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# PRELIMINARY FUNCTIONS -------------------------------------------------------}

\CommentTok{# Function to read in all required packages in one go:}
\NormalTok{loadPackages <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x) \{}
  \ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in}\NormalTok{ x) \{}
    \ControlFlowTok{if}\NormalTok{(}\OperatorTok{!}\KeywordTok{require}\NormalTok{(i, }\DataTypeTok{character.only =} \OtherTok{TRUE}\NormalTok{)) \{}
      \KeywordTok{install.packages}\NormalTok{(i, }\DataTypeTok{dependencies =} \OtherTok{TRUE}\NormalTok{)}
      \KeywordTok{library}\NormalTok{(i, }\DataTypeTok{character.only =} \OtherTok{TRUE}\NormalTok{)}
\NormalTok{    \}}
\NormalTok{  \}}
\NormalTok{\}}

\CommentTok{# Load the packages}
\KeywordTok{loadPackages}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{"tidyverse"}\NormalTok{, }\StringTok{"data.table"}\NormalTok{, }\StringTok{"cowplot"}\NormalTok{))}

\CommentTok{# Create custom theme}
\NormalTok{theme_AP <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{() \{}
  \KeywordTok{theme_bw}\NormalTok{() }\OperatorTok{+}
\StringTok{    }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{panel.grid.major =} \KeywordTok{element_blank}\NormalTok{(),}
          \DataTypeTok{panel.grid.minor =} \KeywordTok{element_blank}\NormalTok{(),}
          \DataTypeTok{legend.background =} \KeywordTok{element_rect}\NormalTok{(}\DataTypeTok{fill =} \StringTok{"transparent"}\NormalTok{,}
                                           \DataTypeTok{color =} \OtherTok{NA}\NormalTok{),}
          \DataTypeTok{legend.key =} \KeywordTok{element_rect}\NormalTok{(}\DataTypeTok{fill =} \StringTok{"transparent"}\NormalTok{,}
                                    \DataTypeTok{color =} \OtherTok{NA}\NormalTok{))}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\newpage

\hypertarget{functions}{%
\section{Functions}\label{functions}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# DEFINE FUNCTIONS TO PLOT ----------------------------------------------------}

\NormalTok{fig1_fun <-}\StringTok{ }\KeywordTok{list}\NormalTok{(}
  \StringTok{"fun1"}\NormalTok{ =}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x) x }\OperatorTok{^}\StringTok{ }\DecValTok{2}\NormalTok{,}
  \StringTok{"fun2"}\NormalTok{ =}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x) }\KeywordTok{ifelse}\NormalTok{(x }\OperatorTok{<}\StringTok{ }\DecValTok{0}\NormalTok{, }\OperatorTok{-}\NormalTok{x, x),}
  \StringTok{"fun3"}\NormalTok{ =}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x) }\KeywordTok{ifelse}\NormalTok{(x }\OperatorTok{<}\StringTok{ }\DecValTok{0}\NormalTok{, }\OperatorTok{-}\StringTok{ }\NormalTok{(x }\OperatorTok{+}\StringTok{ }\DecValTok{1}\NormalTok{) }\OperatorTok{^}\StringTok{ }\DecValTok{2} \OperatorTok{+}\StringTok{ }\DecValTok{1}\NormalTok{, }\OperatorTok{-}\StringTok{ }\NormalTok{(x }\OperatorTok{-}\StringTok{ }\DecValTok{1}\NormalTok{) }\OperatorTok{^}\StringTok{ }\DecValTok{2} \OperatorTok{+}\StringTok{ }\DecValTok{1}\NormalTok{)}
\NormalTok{)}

\NormalTok{fig2_fun <-}\StringTok{ }\KeywordTok{list}\NormalTok{(}
  \StringTok{"fun1"}\NormalTok{ =}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x) }\FloatTok{1.11} \OperatorTok{*}\StringTok{ }\NormalTok{x }\OperatorTok{^}\StringTok{ }\DecValTok{2}\NormalTok{,}
  \StringTok{"fun2"}\NormalTok{ =}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x) x }\OperatorTok{^}\StringTok{ }\DecValTok{2} \OperatorTok{-}\StringTok{ }\FloatTok{0.2} \OperatorTok{*}\StringTok{ }\KeywordTok{cos}\NormalTok{(}\DecValTok{7} \OperatorTok{*}\StringTok{ }\NormalTok{pi }\OperatorTok{*}\StringTok{ }\NormalTok{x)}
\NormalTok{)}

\NormalTok{fig3_fun <-}\StringTok{ }\KeywordTok{list}\NormalTok{(}
  \StringTok{"fun1"}\NormalTok{ =}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x) x,}
  \StringTok{"fun2"}\NormalTok{ =}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x) ((}\OperatorTok{-}\DecValTok{1}\NormalTok{) }\OperatorTok{^}\StringTok{ }\KeywordTok{as.integer}\NormalTok{(}\DecValTok{4} \OperatorTok{*}\StringTok{ }\NormalTok{x) }\OperatorTok{*}\StringTok{ }\NormalTok{(}\FloatTok{0.125} \OperatorTok{-}\StringTok{ }\NormalTok{(x }\OperatorTok{%%}\StringTok{ }\FloatTok{0.25}\NormalTok{)) }\OperatorTok{+}\StringTok{ }\FloatTok{0.125}\NormalTok{),}
  \StringTok{"fun3"}\NormalTok{ =}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x) ((}\OperatorTok{-}\DecValTok{1}\NormalTok{) }\OperatorTok{^}\StringTok{ }\KeywordTok{as.integer}\NormalTok{(}\DecValTok{32} \OperatorTok{*}\StringTok{ }\NormalTok{x) }\OperatorTok{*}\StringTok{ }\NormalTok{(}\FloatTok{0.03125} \OperatorTok{-}\StringTok{ }\DecValTok{2} \OperatorTok{*}\StringTok{ }\NormalTok{(x }\OperatorTok{%%}\StringTok{ }\FloatTok{0.03125}\NormalTok{)) }\OperatorTok{+}\StringTok{ }\FloatTok{0.03125}\NormalTok{) }\OperatorTok{/}\StringTok{ }\DecValTok{2}
\NormalTok{)}

\NormalTok{fig4_fun <-}\StringTok{ }\KeywordTok{list}\NormalTok{(}
  \StringTok{"fun1"}\NormalTok{ =}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x) }\OperatorTok{-}\KeywordTok{sin}\NormalTok{(pi }\OperatorTok{*}\StringTok{ }\NormalTok{x) }\OperatorTok{-}\StringTok{ }\FloatTok{0.3} \OperatorTok{*}\StringTok{ }\KeywordTok{sin}\NormalTok{(}\FloatTok{3.33} \OperatorTok{*}\StringTok{ }\NormalTok{pi }\OperatorTok{*}\StringTok{ }\NormalTok{x),}
  \StringTok{"fun2"}\NormalTok{ =}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x) }\FloatTok{-0.76} \OperatorTok{*}\StringTok{ }\KeywordTok{sin}\NormalTok{(pi }\OperatorTok{*}\StringTok{ }\NormalTok{(x }\OperatorTok{-}\StringTok{ }\FloatTok{0.2}\NormalTok{)) }\OperatorTok{-}\StringTok{ }\FloatTok{0.315}\NormalTok{,}
  \StringTok{"fun3"}\NormalTok{ =}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x) }\FloatTok{-0.12} \OperatorTok{*}\StringTok{ }\KeywordTok{sin}\NormalTok{(}\FloatTok{1.05} \OperatorTok{*}\StringTok{ }\NormalTok{pi }\OperatorTok{*}\StringTok{ }\NormalTok{(x }\OperatorTok{-}\StringTok{ }\FloatTok{0.2}\NormalTok{)) }\OperatorTok{-}\StringTok{ }
\StringTok{    }\FloatTok{0.02} \OperatorTok{*}\StringTok{ }\KeywordTok{sin}\NormalTok{(}\FloatTok{95.24} \OperatorTok{*}\StringTok{ }\NormalTok{pi }\OperatorTok{*}\StringTok{ }\NormalTok{x) }\OperatorTok{-}\StringTok{ }\FloatTok{0.96}\NormalTok{,}
  \StringTok{"fun4"}\NormalTok{ =}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x) }\FloatTok{-0.12} \OperatorTok{*}\StringTok{ }\KeywordTok{sin}\NormalTok{(}\FloatTok{1.05} \OperatorTok{*}\StringTok{ }\NormalTok{pi }\OperatorTok{*}\StringTok{ }\NormalTok{(x }\OperatorTok{-}\StringTok{ }\FloatTok{0.2}\NormalTok{)) }\OperatorTok{-}\StringTok{ }\FloatTok{0.96}\NormalTok{,}
  \StringTok{"fun5"}\NormalTok{ =}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x) }\FloatTok{-0.05} \OperatorTok{*}\StringTok{ }\KeywordTok{sin}\NormalTok{(pi }\OperatorTok{*}\StringTok{ }\NormalTok{(x }\OperatorTok{-}\StringTok{ }\FloatTok{0.2}\NormalTok{)) }\OperatorTok{-}\StringTok{ }\FloatTok{1.02}\NormalTok{,}
  \StringTok{"fun6"}\NormalTok{ =}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x) }\FloatTok{-1.08}
\NormalTok{)}

\CommentTok{# FUNCTION TO PLOT THE FUNCTIONS ----------------------------------------------}

\NormalTok{plot_function <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(fun, min, max) \{}
\NormalTok{  gg <-}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{x =} \KeywordTok{runif}\NormalTok{(}\DecValTok{1000}\NormalTok{, min, max)), }\KeywordTok{aes}\NormalTok{(x)) }\OperatorTok{+}
\StringTok{    }\KeywordTok{map}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\KeywordTok{length}\NormalTok{(fun), }\ControlFlowTok{function}\NormalTok{(nn) \{}
      \KeywordTok{stat_function}\NormalTok{(}\DataTypeTok{fun =}\NormalTok{ fun[[nn]], }
                    \DataTypeTok{geom =} \StringTok{"line"}\NormalTok{, }
                    \KeywordTok{aes_}\NormalTok{(}\DataTypeTok{color =} \KeywordTok{factor}\NormalTok{(}\KeywordTok{names}\NormalTok{(fun[nn]))))}
\NormalTok{    \}) }\OperatorTok{+}
\StringTok{    }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{color =} \StringTok{"Function"}\NormalTok{, }
         \DataTypeTok{x =} \KeywordTok{expression}\NormalTok{(}\KeywordTok{italic}\NormalTok{(x)), }
         \DataTypeTok{y =} \KeywordTok{expression}\NormalTok{(}\KeywordTok{italic}\NormalTok{(y))) }\OperatorTok{+}
\StringTok{    }\KeywordTok{theme_AP}\NormalTok{()}
  \KeywordTok{return}\NormalTok{(gg)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{plot-the-figures}{%
\section{Plot the figures}\label{plot-the-figures}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# PLOT FUNCTIONS -----------------------------------------------------------------}

\NormalTok{a <-}\StringTok{ }\KeywordTok{plot_function}\NormalTok{(}\DataTypeTok{fun =}\NormalTok{ fig1_fun, }\DecValTok{-1}\NormalTok{, }\DecValTok{1}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale_color_manual}\NormalTok{(}\DataTypeTok{labels =} \KeywordTok{c}\NormalTok{(}\StringTok{"$f_1(x)$"}\NormalTok{,}\StringTok{"$f_2(x)$"}\NormalTok{, }\StringTok{"$f_3(x)$"}\NormalTok{), }
                       \DataTypeTok{values =} \KeywordTok{c}\NormalTok{(}\StringTok{"#F8766D"}\NormalTok{, }\StringTok{"#B79F00"}\NormalTok{, }\StringTok{"#00BA38"}\NormalTok{)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{x =} \StringTok{""}\NormalTok{, }\DataTypeTok{y =} \StringTok{"$y$"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{legend.position =} \StringTok{"none"}\NormalTok{) }

\NormalTok{b <-}\StringTok{ }\KeywordTok{plot_function}\NormalTok{(}\DataTypeTok{fun =}\NormalTok{ fig2_fun, }\DecValTok{-1}\NormalTok{, }\DecValTok{1}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale_color_manual}\NormalTok{(}\DataTypeTok{labels =} \KeywordTok{c}\NormalTok{(}\StringTok{"$f_1(x)$"}\NormalTok{,}\StringTok{"$f_2(x)$"}\NormalTok{), }
                     \DataTypeTok{values =} \KeywordTok{c}\NormalTok{(}\StringTok{"#F8766D"}\NormalTok{, }\StringTok{"#B79F00"}\NormalTok{)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{x =} \StringTok{""}\NormalTok{, }\DataTypeTok{y =} \StringTok{""}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{legend.position =} \StringTok{"none"}\NormalTok{)}

\NormalTok{c <-}\StringTok{ }\KeywordTok{plot_function}\NormalTok{(}\DataTypeTok{fun =}\NormalTok{ fig3_fun, }\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale_color_manual}\NormalTok{(}\DataTypeTok{labels =} \KeywordTok{c}\NormalTok{(}\StringTok{"$f_1(x)$"}\NormalTok{,}\StringTok{"$f_2(x)$"}\NormalTok{, }\StringTok{"$f_3(x)$"}\NormalTok{), }
                     \DataTypeTok{values =} \KeywordTok{c}\NormalTok{(}\StringTok{"#F8766D"}\NormalTok{, }\StringTok{"#B79F00"}\NormalTok{, }\StringTok{"#00BA38"}\NormalTok{)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale_x_continuous}\NormalTok{(}\DataTypeTok{breaks =}\NormalTok{ scales}\OperatorTok{::}\KeywordTok{pretty_breaks}\NormalTok{(}\DataTypeTok{n =} \DecValTok{3}\NormalTok{)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{x =} \StringTok{"$x$"}\NormalTok{, }\DataTypeTok{y =} \StringTok{"$y$"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{legend.position =} \StringTok{"none"}\NormalTok{) }

\NormalTok{d <-}\StringTok{ }\KeywordTok{plot_function}\NormalTok{(}\DataTypeTok{fun =}\NormalTok{ fig4_fun, }\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{) }\OperatorTok{+}\StringTok{ }
\StringTok{  }\KeywordTok{scale_color_discrete}\NormalTok{(}\DataTypeTok{labels =} \KeywordTok{c}\NormalTok{(}\StringTok{"$f_1(x)$"}\NormalTok{,}\StringTok{"$f_2(x)$"}\NormalTok{, }\StringTok{"$f_3(x)$"}\NormalTok{, }
                                  \StringTok{"$f_4(x)$"}\NormalTok{,}\StringTok{"$f_5(x)$"}\NormalTok{, }\StringTok{"$f_6(x)$"}\NormalTok{)) }\OperatorTok{+}\StringTok{ }
\StringTok{  }\KeywordTok{scale_x_continuous}\NormalTok{(}\DataTypeTok{breaks =}\NormalTok{ scales}\OperatorTok{::}\KeywordTok{pretty_breaks}\NormalTok{(}\DataTypeTok{n =} \DecValTok{3}\NormalTok{)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{x =} \StringTok{"$x$"}\NormalTok{, }\DataTypeTok{y =} \StringTok{""}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{legend.position =} \StringTok{"none"}\NormalTok{)}

\NormalTok{legend <-}\StringTok{ }\KeywordTok{get_legend}\NormalTok{(d }\OperatorTok{+}\StringTok{ }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{legend.position =} \StringTok{"top"}\NormalTok{))}

\NormalTok{bottom <-}\StringTok{ }\KeywordTok{plot_grid}\NormalTok{(a, b, c, d, }\DataTypeTok{ncol =} \DecValTok{2}\NormalTok{, }\DataTypeTok{align =} \StringTok{"hv"}\NormalTok{, }\DataTypeTok{labels =} \StringTok{"auto"}\NormalTok{)}

\KeywordTok{plot_grid}\NormalTok{(legend, bottom, }\DataTypeTok{ncol =} \DecValTok{1}\NormalTok{, }\DataTypeTok{rel_heights =} \KeywordTok{c}\NormalTok{(}\FloatTok{0.2}\NormalTok{, }\DecValTok{1}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\includegraphics{code_vars_design_files/figure-latex/design_figure_final-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# PLOT FIGURE LIU -------------------------------------------------------------}

\NormalTok{mat <-}\StringTok{ }\NormalTok{randtoolbox}\OperatorTok{::}\KeywordTok{sobol}\NormalTok{(}\DataTypeTok{n =} \DecValTok{1000}\NormalTok{, }\DataTypeTok{dim =} \DecValTok{2}\NormalTok{)}
\NormalTok{mat[, }\DecValTok{1}\NormalTok{] <-}\StringTok{ }\KeywordTok{qchisq}\NormalTok{(mat[, }\DecValTok{1}\NormalTok{], }\DataTypeTok{df =} \DecValTok{10}\NormalTok{)}
\NormalTok{mat[, }\DecValTok{2}\NormalTok{] <-}\StringTok{ }\KeywordTok{qchisq}\NormalTok{(mat[, }\DecValTok{2}\NormalTok{], }\DataTypeTok{df =} \FloatTok{13.978}\NormalTok{)}

\NormalTok{fig.}\FloatTok{5.}\NormalTok{tikz <-}\StringTok{ }\KeywordTok{data.table}\NormalTok{(mat) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{melt}\NormalTok{(., }\DataTypeTok{measure.vars =} \KeywordTok{c}\NormalTok{(}\StringTok{"V1"}\NormalTok{, }\StringTok{"V2"}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(., }\KeywordTok{aes}\NormalTok{(value, }\DataTypeTok{group =}\NormalTok{ variable, }\DataTypeTok{colour =}\NormalTok{ variable)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_density}\NormalTok{() }\OperatorTok{+}\StringTok{ }
\StringTok{  }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{x =} \KeywordTok{expression}\NormalTok{(}\KeywordTok{italic}\NormalTok{(x)), }
       \DataTypeTok{y =} \StringTok{"Density"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale_color_discrete}\NormalTok{(}\DataTypeTok{name =} \StringTok{""}\NormalTok{, }
                       \DataTypeTok{labels =} \KeywordTok{c}\NormalTok{(}\StringTok{"$X_1 }\CharTok{\textbackslash{}\textbackslash{}}\StringTok{sim }\CharTok{\textbackslash{}\textbackslash{}}\StringTok{chi_\{10\} ^ \{2\}$"}\NormalTok{,}
                                  \StringTok{"$X_2 }\CharTok{\textbackslash{}\textbackslash{}}\StringTok{sim }\CharTok{\textbackslash{}\textbackslash{}}\StringTok{chi_\{13.978\} ^ \{2\}$"}\NormalTok{)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{theme_AP}\NormalTok{() }\OperatorTok{+}\StringTok{ }
\StringTok{  }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{legend.text.align =} \DecValTok{0}\NormalTok{, }
        \DataTypeTok{legend.position =} \KeywordTok{c}\NormalTok{(}\FloatTok{0.93}\NormalTok{, }\FloatTok{0.8}\NormalTok{))}

\CommentTok{# Fig.6}
\NormalTok{mat <-}\StringTok{ }\NormalTok{randtoolbox}\OperatorTok{::}\KeywordTok{sobol}\NormalTok{(}\DataTypeTok{n =} \DecValTok{1000}\NormalTok{, }\DataTypeTok{dim =} \DecValTok{2}\NormalTok{)}
\NormalTok{Y <-}\StringTok{ }\KeywordTok{qchisq}\NormalTok{(mat[, }\DecValTok{1}\NormalTok{], }\DataTypeTok{df =} \DecValTok{10}\NormalTok{) }\OperatorTok{/}\StringTok{ }\KeywordTok{qchisq}\NormalTok{(mat[, }\DecValTok{2}\NormalTok{], }\DataTypeTok{df =} \FloatTok{13.978}\NormalTok{)}
\NormalTok{X1.fixed <-}\StringTok{ }\DecValTok{10} \OperatorTok{/}\StringTok{ }\KeywordTok{qchisq}\NormalTok{(mat[, }\DecValTok{2}\NormalTok{], }\DataTypeTok{df =} \FloatTok{13.978}\NormalTok{)}
\NormalTok{X2.fixed <-}\StringTok{ }\KeywordTok{qchisq}\NormalTok{(mat[, }\DecValTok{1}\NormalTok{], }\DataTypeTok{df =} \DecValTok{10}\NormalTok{) }\OperatorTok{/}\StringTok{ }\FloatTok{13.978}

\NormalTok{fig.}\FloatTok{6.}\NormalTok{tikz <-}\StringTok{ }\KeywordTok{cbind}\NormalTok{(Y, X1.fixed, X2.fixed) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{data.table}\NormalTok{() }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{melt}\NormalTok{(., }\DataTypeTok{measure.vars =} \KeywordTok{c}\NormalTok{(}\StringTok{"Y"}\NormalTok{, }\StringTok{"X1.fixed"}\NormalTok{, }\StringTok{"X2.fixed"}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(., }\KeywordTok{aes}\NormalTok{(value, }\DataTypeTok{color =}\NormalTok{ variable)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_density}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale_color_discrete}\NormalTok{(}\DataTypeTok{name =} \StringTok{""}\NormalTok{, }\DataTypeTok{labels =} \KeywordTok{c}\NormalTok{(}\StringTok{"Original PDF of Y"}\NormalTok{, }
                                             \StringTok{"$X_1$ fixed"}\NormalTok{, }
                                             \StringTok{"$X_2$ fixed"}\NormalTok{)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{x =} \KeywordTok{expression}\NormalTok{(}\KeywordTok{italic}\NormalTok{(y)), }
       \DataTypeTok{y =} \StringTok{""}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{theme_AP}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{legend.text.align =} \DecValTok{0}\NormalTok{, }
        \DataTypeTok{legend.position =} \KeywordTok{c}\NormalTok{(}\FloatTok{0.6}\NormalTok{, }\FloatTok{0.8}\NormalTok{))}

\KeywordTok{plot_grid}\NormalTok{(fig.}\FloatTok{5.}\NormalTok{tikz, fig.}\FloatTok{6.}\NormalTok{tikz, }\DataTypeTok{labels =} \StringTok{"auto"}\NormalTok{, }\DataTypeTok{align =} \StringTok{"hv"}\NormalTok{, }\DataTypeTok{ncol =} \DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{code_vars_design_files/figure-latex/liu_tikz-1.pdf}

\newpage

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# CREATE STAR-VARS MATRICES ------------------------------------------------------}

\NormalTok{vars_matrices <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(star.centers, params, h, }\DataTypeTok{method =} \StringTok{"QRN"}\NormalTok{) \{}
\NormalTok{  out <-}\StringTok{ }\NormalTok{center <-}\StringTok{ }\NormalTok{sections <-}\StringTok{ }\NormalTok{A <-}\StringTok{ }\NormalTok{B <-}\StringTok{ }\NormalTok{AB <-}\StringTok{ }\NormalTok{X <-}\StringTok{ }\NormalTok{out <-}\StringTok{ }\KeywordTok{list}\NormalTok{()}
  \ControlFlowTok{if}\NormalTok{(method }\OperatorTok{==}\StringTok{ "QRN"}\NormalTok{) \{}
\NormalTok{    mat <-}\StringTok{ }\NormalTok{randtoolbox}\OperatorTok{::}\KeywordTok{sobol}\NormalTok{(}\DataTypeTok{n =}\NormalTok{ star.centers, }\DataTypeTok{dim =} \KeywordTok{length}\NormalTok{(params))}
\NormalTok{  \} }\ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{(method }\OperatorTok{==}\StringTok{ "R"}\NormalTok{) \{}
\NormalTok{    mat <-}\StringTok{ }\KeywordTok{replicate}\NormalTok{(}\KeywordTok{length}\NormalTok{(params), stats}\OperatorTok{::}\KeywordTok{runif}\NormalTok{(star.centers))}
\NormalTok{  \} }\ControlFlowTok{else}\NormalTok{ \{}
    \KeywordTok{stop}\NormalTok{(}\StringTok{"method should be either QRN, R or LHS"}\NormalTok{)}
\NormalTok{  \}}
  \ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{nrow}\NormalTok{(mat)) \{}
\NormalTok{    center[[i]] <-}\StringTok{ }\NormalTok{mat[i, ]}
\NormalTok{    sections[[i]] <-}\StringTok{ }\KeywordTok{sapply}\NormalTok{(center[[i]], }\ControlFlowTok{function}\NormalTok{(x) \{}
\NormalTok{      all <-}\StringTok{ }\KeywordTok{seq}\NormalTok{(x }\OperatorTok{%%}\StringTok{ }\NormalTok{h, }\DecValTok{1}\NormalTok{, h)}
\NormalTok{      non.zeros <-}\StringTok{ }\NormalTok{all[all}\OperatorTok{!=}\StringTok{ }\DecValTok{0}\NormalTok{]}
\NormalTok{    \})}
\NormalTok{    B[[i]] <-}\StringTok{ }\KeywordTok{sapply}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\KeywordTok{ncol}\NormalTok{(mat), }\ControlFlowTok{function}\NormalTok{(x) }
\NormalTok{      sections[[i]][, x][}\OperatorTok{!}\NormalTok{sections[[i]][, x] }\OperatorTok{%in%}\StringTok{ }\NormalTok{center[[i]][x]])}
\NormalTok{    A[[i]] <-}\StringTok{ }\KeywordTok{matrix}\NormalTok{(center[[i]], }\DataTypeTok{nrow =} \KeywordTok{nrow}\NormalTok{(B[[i]]), }
                     \DataTypeTok{ncol =} \KeywordTok{length}\NormalTok{(center[[i]]), }\DataTypeTok{byrow =} \OtherTok{TRUE}\NormalTok{)}
\NormalTok{    X[[i]] <-}\StringTok{ }\KeywordTok{rbind}\NormalTok{(A[[i]], B[[i]])}
    \ControlFlowTok{for}\NormalTok{(j }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{ncol}\NormalTok{(A[[i]])) \{}
\NormalTok{      AB[[i]] <-}\StringTok{ }\NormalTok{A[[i]]}
\NormalTok{      AB[[i]][, j] <-}\StringTok{ }\NormalTok{B[[i]][, j]}
\NormalTok{      X[[i]] <-}\StringTok{ }\KeywordTok{rbind}\NormalTok{(X[[i]], AB[[i]])}
\NormalTok{    \}}
\NormalTok{    AB[[i]] <-}\StringTok{ }\NormalTok{X[[i]][(}\DecValTok{2} \OperatorTok{*}\StringTok{ }\KeywordTok{nrow}\NormalTok{(B[[i]]) }\OperatorTok{+}\StringTok{ }\DecValTok{1}\NormalTok{)}\OperatorTok{:}\KeywordTok{nrow}\NormalTok{(X[[i]]), ]}
\NormalTok{    out[[i]] <-}\StringTok{ }\KeywordTok{rbind}\NormalTok{(}\KeywordTok{unname}\NormalTok{(center[[i]]), AB[[i]])}
\NormalTok{  \}}
  \KeywordTok{return}\NormalTok{(}\KeywordTok{do.call}\NormalTok{(rbind, out))}
\NormalTok{\}}

\CommentTok{# CREATE VARS FUNCTION -----------------------------------------------------------}

\CommentTok{# Function to cut by size}
\NormalTok{CutBySize <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(m, block.size, }\DataTypeTok{nb =} \KeywordTok{ceiling}\NormalTok{(m }\OperatorTok{/}\StringTok{ }\NormalTok{block.size)) \{}
\NormalTok{  int <-}\StringTok{ }\NormalTok{m }\OperatorTok{/}\StringTok{ }\NormalTok{nb}
\NormalTok{  upper <-}\StringTok{ }\KeywordTok{round}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\NormalTok{nb }\OperatorTok{*}\StringTok{ }\NormalTok{int)}
\NormalTok{  lower <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, upper[}\OperatorTok{-}\NormalTok{nb] }\OperatorTok{+}\StringTok{ }\DecValTok{1}\NormalTok{)}
\NormalTok{  size <-}\StringTok{ }\KeywordTok{c}\NormalTok{(upper[}\DecValTok{1}\NormalTok{], }\KeywordTok{diff}\NormalTok{(upper))}
  \KeywordTok{cbind}\NormalTok{(lower, upper, size)}
\NormalTok{\}}

\CommentTok{# VARS-TO algorithm}
\NormalTok{vars_ti <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(Y, star.centers, params, h, }\DataTypeTok{method =} \StringTok{"all.step"}\NormalTok{) \{}
\NormalTok{  n.cross.points <-}\StringTok{ }\KeywordTok{length}\NormalTok{(params) }\OperatorTok{*}\StringTok{ }\NormalTok{((}\DecValTok{1} \OperatorTok{/}\StringTok{ }\NormalTok{h) }\OperatorTok{-}\StringTok{ }\DecValTok{1}\NormalTok{) }\OperatorTok{+}\StringTok{ }\DecValTok{1}
\NormalTok{  index.centers <-}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{, }\KeywordTok{length}\NormalTok{(Y), n.cross.points)}
\NormalTok{  mat <-}\StringTok{ }\KeywordTok{matrix}\NormalTok{(Y[}\OperatorTok{-}\NormalTok{index.centers], }\DataTypeTok{ncol =}\NormalTok{ star.centers)}
\NormalTok{  indices <-}\StringTok{ }\KeywordTok{CutBySize}\NormalTok{(}\KeywordTok{nrow}\NormalTok{(mat), }\DataTypeTok{nb =} \KeywordTok{length}\NormalTok{(params))}
\NormalTok{  out <-}\StringTok{ }\KeywordTok{list}\NormalTok{()}
  \ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{nrow}\NormalTok{(indices)) \{}
\NormalTok{    out[[i]] <-}\StringTok{ }\NormalTok{mat[indices[i, }\StringTok{"lower"}\NormalTok{]}\OperatorTok{:}\NormalTok{indices[i, }\StringTok{"upper"}\NormalTok{], ]}
\NormalTok{  \}}
  \ControlFlowTok{if}\NormalTok{(method }\OperatorTok{==}\StringTok{ "one.step"}\NormalTok{) \{}
\NormalTok{    d <-}\StringTok{ }\KeywordTok{lapply}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\KeywordTok{length}\NormalTok{(params), }\ControlFlowTok{function}\NormalTok{(x) }
      \KeywordTok{lapply}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\KeywordTok{ncol}\NormalTok{(out[[x]]), }\ControlFlowTok{function}\NormalTok{(j) \{}
\NormalTok{        da <-}\StringTok{ }\KeywordTok{c}\NormalTok{(out[[x]][, j][}\DecValTok{1}\NormalTok{], }
                \KeywordTok{rep}\NormalTok{(out[[x]][, j][}\OperatorTok{-}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\KeywordTok{length}\NormalTok{(out[[x]][, j]))], }\DataTypeTok{each =} \DecValTok{2}\NormalTok{), }
\NormalTok{                out[[x]][, j][}\KeywordTok{length}\NormalTok{(out[[x]][, j])])}
\NormalTok{      \}))}
\NormalTok{  \} }\ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{(method }\OperatorTok{==}\StringTok{ "all.step"}\NormalTok{) \{}
\NormalTok{    d <-}\StringTok{ }\KeywordTok{lapply}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\KeywordTok{length}\NormalTok{(params), }\ControlFlowTok{function}\NormalTok{(x) }
      \KeywordTok{lapply}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\KeywordTok{ncol}\NormalTok{(out[[x]]), }\ControlFlowTok{function}\NormalTok{(j) \{}
\NormalTok{        da <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\KeywordTok{combn}\NormalTok{(out[[x]][, j], }\DecValTok{2}\NormalTok{))}
\NormalTok{      \}))}
\NormalTok{  \} }\ControlFlowTok{else}\NormalTok{ \{}
    \KeywordTok{stop}\NormalTok{(}\StringTok{"method should be either one.step or all.step"}\NormalTok{)}
\NormalTok{  \}}
\NormalTok{  out <-}\StringTok{ }\KeywordTok{lapply}\NormalTok{(d, }\ControlFlowTok{function}\NormalTok{(x) }
    \KeywordTok{lapply}\NormalTok{(x, }\ControlFlowTok{function}\NormalTok{(y) }\KeywordTok{matrix}\NormalTok{(y, }\DataTypeTok{nrow =} \KeywordTok{length}\NormalTok{(y) }\OperatorTok{/}\StringTok{ }\DecValTok{2}\NormalTok{, }\DataTypeTok{byrow =} \OtherTok{TRUE}\NormalTok{)))}
\NormalTok{  variogr <-}\StringTok{ }\KeywordTok{unlist}\NormalTok{(}\KeywordTok{lapply}\NormalTok{(out, }\ControlFlowTok{function}\NormalTok{(x) }\KeywordTok{lapply}\NormalTok{(x, }\ControlFlowTok{function}\NormalTok{(y) }
    \KeywordTok{mean}\NormalTok{(}\FloatTok{0.5} \OperatorTok{*}\StringTok{ }\NormalTok{(y[, }\DecValTok{1}\NormalTok{] }\OperatorTok{-}\StringTok{ }\NormalTok{y[, }\DecValTok{2}\NormalTok{]) }\OperatorTok{^}\StringTok{ }\DecValTok{2}\NormalTok{))) }\OperatorTok{%>%}
\StringTok{      }\KeywordTok{lapply}\NormalTok{(., }\ControlFlowTok{function}\NormalTok{(x) }\KeywordTok{do.call}\NormalTok{(rbind, x)) }\OperatorTok{%>%}
\StringTok{      }\KeywordTok{lapply}\NormalTok{(., mean))}
\NormalTok{  covariogr <-}\StringTok{ }\KeywordTok{unlist}\NormalTok{(}\KeywordTok{lapply}\NormalTok{(out, }\ControlFlowTok{function}\NormalTok{(x)}
    \KeywordTok{lapply}\NormalTok{(x, }\ControlFlowTok{function}\NormalTok{(y) }\KeywordTok{cov}\NormalTok{(y[, }\DecValTok{1}\NormalTok{], y[, }\DecValTok{2}\NormalTok{]))) }\OperatorTok{%>%}
\StringTok{      }\KeywordTok{lapply}\NormalTok{(., }\ControlFlowTok{function}\NormalTok{(x) Rfast}\OperatorTok{::}\KeywordTok{colmeans}\NormalTok{(}\KeywordTok{do.call}\NormalTok{(rbind, x))))}
\NormalTok{  VY <-}\StringTok{ }\KeywordTok{var}\NormalTok{(Y[index.centers])}
\NormalTok{  Ti <-}\StringTok{ }\NormalTok{(variogr }\OperatorTok{+}\StringTok{ }\NormalTok{covariogr) }\OperatorTok{/}\StringTok{ }\NormalTok{VY}
\NormalTok{  output <-}\StringTok{ }\NormalTok{data.table}\OperatorTok{::}\KeywordTok{data.table}\NormalTok{(Ti)}
\NormalTok{  output[, }\StringTok{`}\DataTypeTok{:=}\StringTok{`}\NormalTok{(}\DataTypeTok{parameters =}\NormalTok{ params)]}
  \KeywordTok{return}\NormalTok{(output)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# DEFINE JANSEN TOTAL-ORDER INDEX ------------------------------------------------}

\NormalTok{jansen_ti <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(d, N, params) \{}
\NormalTok{  m <-}\StringTok{ }\KeywordTok{matrix}\NormalTok{(d, }\DataTypeTok{nrow =}\NormalTok{ N)}
\NormalTok{  k <-}\StringTok{ }\KeywordTok{length}\NormalTok{(params)}
\NormalTok{  Y_A <-}\StringTok{ }\NormalTok{m[, }\DecValTok{1}\NormalTok{]}
\NormalTok{  Y_AB <-}\StringTok{ }\NormalTok{m[, }\DecValTok{-1}\NormalTok{]}
\NormalTok{  f0 <-}\StringTok{ }\NormalTok{(}\DecValTok{1} \OperatorTok{/}\StringTok{ }\KeywordTok{length}\NormalTok{(Y_A)) }\OperatorTok{*}\StringTok{ }\KeywordTok{sum}\NormalTok{(Y_A)}
\NormalTok{  VY <-}\StringTok{ }\DecValTok{1} \OperatorTok{/}\StringTok{ }\KeywordTok{length}\NormalTok{(Y_A) }\OperatorTok{*}\StringTok{ }\KeywordTok{sum}\NormalTok{((Y_A }\OperatorTok{-}\StringTok{ }\NormalTok{f0) }\OperatorTok{^}\StringTok{ }\DecValTok{2}\NormalTok{)}
\NormalTok{  Ti <-}\StringTok{ }\NormalTok{(}\DecValTok{1} \OperatorTok{/}\StringTok{ }\NormalTok{(}\DecValTok{2} \OperatorTok{*}\StringTok{ }\NormalTok{N) }\OperatorTok{*}\StringTok{ }\NormalTok{Rfast}\OperatorTok{::}\KeywordTok{colsums}\NormalTok{((Y_A }\OperatorTok{-}\StringTok{ }\NormalTok{Y_AB) }\OperatorTok{^}\StringTok{ }\DecValTok{2}\NormalTok{)) }\OperatorTok{/}\StringTok{ }\NormalTok{VY}
\NormalTok{  output <-}\StringTok{ }\KeywordTok{data.table}\NormalTok{(Ti)}
\NormalTok{  output[, }\StringTok{`}\DataTypeTok{:=}\StringTok{`}\NormalTok{(}\DataTypeTok{parameters =} \KeywordTok{paste}\NormalTok{(}\StringTok{"X"}\NormalTok{, }\DecValTok{1}\OperatorTok{:}\NormalTok{k, }\DataTypeTok{sep =} \StringTok{""}\NormalTok{))]}
  \KeywordTok{return}\NormalTok{(output)}
\NormalTok{\}}

\CommentTok{# DEFINE SAVAGE SCORES -----------------------------------------------------------}
\NormalTok{savage_scores <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x) \{}
\NormalTok{  true.ranks <-}\StringTok{ }\KeywordTok{rank}\NormalTok{(}\OperatorTok{-}\NormalTok{x)}
\NormalTok{  p <-}\StringTok{ }\KeywordTok{sort}\NormalTok{(}\DecValTok{1} \OperatorTok{/}\StringTok{ }\NormalTok{true.ranks)}
\NormalTok{  mat <-}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\KeywordTok{rep}\NormalTok{(p, }\KeywordTok{length}\NormalTok{(p)), }\DataTypeTok{nrow =} \KeywordTok{length}\NormalTok{(p), }\DataTypeTok{byrow =} \OtherTok{TRUE}\NormalTok{)}
\NormalTok{  mat[}\KeywordTok{upper.tri}\NormalTok{(mat)] <-}\StringTok{ }\DecValTok{0}
\NormalTok{  out <-}\StringTok{ }\KeywordTok{sort}\NormalTok{(}\KeywordTok{rowSums}\NormalTok{(mat), }\DataTypeTok{decreasing =} \OtherTok{TRUE}\NormalTok{)[true.ranks]}
  \KeywordTok{return}\NormalTok{(out)}
\NormalTok{\}}

\CommentTok{# DEFINE FUNCTION FOR RANDOM DISTRIBUTIONS ---------------------------------------}

\NormalTok{sample_distributions <-}\StringTok{ }\KeywordTok{list}\NormalTok{(}
  \StringTok{"uniform"}\NormalTok{ =}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x) x,}
  \StringTok{"normal"}\NormalTok{ =}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x) }\KeywordTok{qnorm}\NormalTok{(x, }\FloatTok{0.5}\NormalTok{, }\FloatTok{0.2}\NormalTok{),}
  \StringTok{"beta"}\NormalTok{ =}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x) }\KeywordTok{qbeta}\NormalTok{(x, }\DecValTok{8}\NormalTok{, }\DecValTok{2}\NormalTok{),}
  \StringTok{"beta2"}\NormalTok{ =}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x) }\KeywordTok{qbeta}\NormalTok{(x, }\DecValTok{2}\NormalTok{, }\DecValTok{8}\NormalTok{),}
  \StringTok{"beta3"}\NormalTok{ =}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x) }\KeywordTok{qbeta}\NormalTok{(x, }\DecValTok{2}\NormalTok{, }\FloatTok{0.5}\NormalTok{),}
  \StringTok{"beta4"}\NormalTok{ =}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x) }\KeywordTok{qbeta}\NormalTok{(x, }\FloatTok{0.5}\NormalTok{, }\DecValTok{2}\NormalTok{),}
  \StringTok{"logitnormal"}\NormalTok{ =}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x) }\KeywordTok{qlogitnorm}\NormalTok{(x, }\DecValTok{0}\NormalTok{, }\FloatTok{3.16}\NormalTok{)}
  \CommentTok{# Logit-normal, Bates too?}
\NormalTok{)}

\NormalTok{random_distributions <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(X, phi) \{}
\NormalTok{  names_ff <-}\StringTok{ }\KeywordTok{names}\NormalTok{(sample_distributions)}
  \ControlFlowTok{if}\NormalTok{(}\OperatorTok{!}\NormalTok{phi }\OperatorTok{==}\StringTok{ }\KeywordTok{length}\NormalTok{(names_ff) }\OperatorTok{+}\StringTok{ }\DecValTok{1}\NormalTok{) \{}
\NormalTok{    out <-}\StringTok{ }\KeywordTok{apply}\NormalTok{(X, }\DecValTok{2}\NormalTok{, }\ControlFlowTok{function}\NormalTok{(x) }
\NormalTok{      sample_distributions[[names_ff[phi]]](x))}
\NormalTok{  \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{    temp <-}\StringTok{ }\KeywordTok{sample}\NormalTok{(names_ff, }\KeywordTok{ncol}\NormalTok{(X), }\DataTypeTok{replace =} \OtherTok{TRUE}\NormalTok{)}
\NormalTok{    out <-}\StringTok{ }\KeywordTok{sapply}\NormalTok{(}\KeywordTok{seq_along}\NormalTok{(temp), }\ControlFlowTok{function}\NormalTok{(x) sample_distributions[[temp[x]]](X[, x]))}
\NormalTok{  \}}
  \KeywordTok{return}\NormalTok{(out)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{sample-matrix}{%
\section{Sample matrix}\label{sample-matrix}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# DEFINE SETTINGS -----------------------------------------------------------------}

\NormalTok{N <-}\StringTok{ }\DecValTok{2} \OperatorTok{^}\StringTok{ }\DecValTok{12} \CommentTok{# Sample size of sample matrix}
\NormalTok{R <-}\StringTok{ }\DecValTok{500} \CommentTok{# Number of bootstrap replicas}
\NormalTok{n_cores <-}\StringTok{ }\KeywordTok{ceiling}\NormalTok{(}\KeywordTok{detectCores}\NormalTok{() }\OperatorTok{*}\StringTok{ }\FloatTok{0.5}\NormalTok{)}
\NormalTok{order <-}\StringTok{ "first"}
\NormalTok{params <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"N.stars"}\NormalTok{, }\StringTok{"h"}\NormalTok{, }\StringTok{"k"}\NormalTok{, }\StringTok{"k_2"}\NormalTok{, }\StringTok{"k_3"}\NormalTok{, }\StringTok{"epsilon"}\NormalTok{, }\StringTok{"delta"}\NormalTok{, }\StringTok{"phi"}\NormalTok{, }\StringTok{"tau"}\NormalTok{) }
\NormalTok{N.high <-}\StringTok{ }\DecValTok{2} \OperatorTok{^}\StringTok{ }\DecValTok{12} \CommentTok{# Maximum sample size of the large sample matrix}

\CommentTok{# CREATE SAMPLE MATRIX ------------------------------------------------------------}

\NormalTok{mat <-}\StringTok{ }\KeywordTok{sobol_matrices}\NormalTok{(}\DataTypeTok{N =}\NormalTok{ N, }\DataTypeTok{params =}\NormalTok{ params, }\DataTypeTok{order =}\NormalTok{ order)}

\CommentTok{# TRANSFORM MATRIX ----------------------------------------------------------------}

\NormalTok{mat[, }\DecValTok{1}\NormalTok{] <-}\StringTok{ }\KeywordTok{round}\NormalTok{(}\KeywordTok{qunif}\NormalTok{(mat[, }\DecValTok{1}\NormalTok{], }\DecValTok{3}\NormalTok{, }\DecValTok{20}\NormalTok{), }\DecValTok{0}\NormalTok{) }\CommentTok{# N.stars}
\NormalTok{mat[, }\DecValTok{2}\NormalTok{] <-}\StringTok{ }\KeywordTok{round}\NormalTok{(}\KeywordTok{qunif}\NormalTok{(mat[, }\DecValTok{2}\NormalTok{], }\DecValTok{1}\NormalTok{, }\DecValTok{4}\NormalTok{), }\DecValTok{0}\NormalTok{) }\CommentTok{# h}
\NormalTok{mat[, }\DecValTok{3}\NormalTok{] <-}\StringTok{ }\KeywordTok{round}\NormalTok{(}\KeywordTok{qunif}\NormalTok{(mat[, }\DecValTok{3}\NormalTok{], }\DecValTok{3}\NormalTok{, }\DecValTok{50}\NormalTok{)) }\CommentTok{# k}
\NormalTok{mat[, }\DecValTok{4}\NormalTok{] <-}\StringTok{ }\KeywordTok{round}\NormalTok{(}\KeywordTok{qunif}\NormalTok{(mat[, }\DecValTok{4}\NormalTok{], }\FloatTok{0.5}\NormalTok{, }\DecValTok{1}\NormalTok{), }\DecValTok{1}\NormalTok{) }\CommentTok{# k_2}
\NormalTok{mat[, }\DecValTok{5}\NormalTok{] <-}\StringTok{ }\KeywordTok{round}\NormalTok{(}\KeywordTok{qunif}\NormalTok{(mat[, }\DecValTok{5}\NormalTok{], }\FloatTok{0.3}\NormalTok{, }\DecValTok{1}\NormalTok{), }\DecValTok{1}\NormalTok{) }\CommentTok{# k_3}
\NormalTok{mat[, }\DecValTok{6}\NormalTok{] <-}\StringTok{ }\KeywordTok{round}\NormalTok{(}\KeywordTok{qunif}\NormalTok{(mat[, }\DecValTok{6}\NormalTok{], }\DecValTok{1}\NormalTok{, }\DecValTok{200}\NormalTok{), }\DecValTok{0}\NormalTok{) }\CommentTok{# epsilon}
\NormalTok{mat[, }\DecValTok{7}\NormalTok{] <-}\StringTok{ }\KeywordTok{round}\NormalTok{(}\KeywordTok{qunif}\NormalTok{(mat[, }\DecValTok{7}\NormalTok{], }\DecValTok{1}\NormalTok{, }\DecValTok{3}\NormalTok{), }\DecValTok{0}\NormalTok{) }\CommentTok{# delta}
\NormalTok{mat[, }\DecValTok{8}\NormalTok{] <-}\StringTok{ }\KeywordTok{round}\NormalTok{(}\KeywordTok{qunif}\NormalTok{(mat[, }\DecValTok{8}\NormalTok{], }\DecValTok{1}\NormalTok{, }\DecValTok{8}\NormalTok{), }\DecValTok{0}\NormalTok{) }\CommentTok{# phi}
\NormalTok{mat[, }\DecValTok{9}\NormalTok{] <-}\StringTok{ }\KeywordTok{floor}\NormalTok{(mat[, }\DecValTok{9}\NormalTok{] }\OperatorTok{*}\StringTok{ }\NormalTok{(}\DecValTok{2} \OperatorTok{-}\StringTok{ }\DecValTok{1} \OperatorTok{+}\StringTok{ }\DecValTok{1}\NormalTok{)) }\OperatorTok{+}\StringTok{ }\DecValTok{1} \CommentTok{# tau}

\CommentTok{# DEFINE TOTAL NUMBER OF RUNS ----------------------------------------------------}

\CommentTok{# Correct h}
\NormalTok{mat[, }\StringTok{"h"}\NormalTok{] <-}\StringTok{ }\KeywordTok{ifelse}\NormalTok{(mat[, }\StringTok{"h"}\NormalTok{] }\OperatorTok{==}\StringTok{ }\DecValTok{1}\NormalTok{, }\FloatTok{0.01}\NormalTok{, }
                     \KeywordTok{ifelse}\NormalTok{(mat[, }\StringTok{"h"}\NormalTok{] }\OperatorTok{==}\StringTok{ }\DecValTok{2}\NormalTok{, }\FloatTok{0.05}\NormalTok{, }
                            \KeywordTok{ifelse}\NormalTok{(mat[, }\StringTok{"h"}\NormalTok{] }\OperatorTok{==}\StringTok{ }\DecValTok{3}\NormalTok{, }\FloatTok{0.1}\NormalTok{, }\FloatTok{0.2}\NormalTok{)))}

\CommentTok{# For vars}
\NormalTok{Nt.vars <-}\StringTok{ }\KeywordTok{round}\NormalTok{(}\KeywordTok{apply}\NormalTok{(mat, }\DecValTok{1}\NormalTok{, }\ControlFlowTok{function}\NormalTok{(x) }
\NormalTok{  x[}\StringTok{"N.stars"}\NormalTok{] }\OperatorTok{*}\StringTok{ }\NormalTok{(x[}\StringTok{"k"}\NormalTok{] }\OperatorTok{*}\StringTok{ }\NormalTok{((}\DecValTok{1} \OperatorTok{/}\StringTok{ }\NormalTok{x[}\StringTok{"h"}\NormalTok{]) }\OperatorTok{-}\StringTok{ }\DecValTok{1}\NormalTok{) }\OperatorTok{+}\StringTok{ }\DecValTok{1}\NormalTok{)), }\DecValTok{0}\NormalTok{)}

\CommentTok{# For jansen}
\NormalTok{N.jansen <-}\StringTok{ }\KeywordTok{round}\NormalTok{(}\KeywordTok{apply}\NormalTok{(}\KeywordTok{cbind}\NormalTok{(mat, Nt.vars), }\DecValTok{1}\NormalTok{, }\ControlFlowTok{function}\NormalTok{(x) }
\NormalTok{  x[}\StringTok{"Nt.vars"}\NormalTok{] }\OperatorTok{/}\StringTok{ }\NormalTok{(x[}\StringTok{"k"}\NormalTok{] }\OperatorTok{+}\StringTok{ }\DecValTok{1}\NormalTok{))) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{ifelse}\NormalTok{(. }\OperatorTok{==}\StringTok{ }\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, .) }\CommentTok{# Transform N = 1 to N = 2 for jansen}

\NormalTok{Nt.jansen <-}\StringTok{ }\KeywordTok{apply}\NormalTok{(}\KeywordTok{cbind}\NormalTok{(mat, Nt.vars, N.jansen), }\DecValTok{1}\NormalTok{, }\ControlFlowTok{function}\NormalTok{(x) }
\NormalTok{  x[}\StringTok{"N.jansen"}\NormalTok{] }\OperatorTok{*}\StringTok{ }\NormalTok{(x[}\StringTok{"k"}\NormalTok{] }\OperatorTok{+}\StringTok{ }\DecValTok{1}\NormalTok{))}

\CommentTok{# FINAL MATRIX --------------------------------------------------------------------}

\NormalTok{mat <-}\StringTok{ }\KeywordTok{cbind}\NormalTok{(mat, Nt.vars, N.jansen, Nt.jansen)}

\CommentTok{# Check min and max total number of runs}
\KeywordTok{sapply}\NormalTok{(}\KeywordTok{c}\NormalTok{(min, max), }\ControlFlowTok{function}\NormalTok{(x) }\KeywordTok{x}\NormalTok{(mat[, }\StringTok{"Nt.vars"}\NormalTok{]))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1]    51 99020
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# SHOW SAMPLE MATRIX -------------------------------------------------------------}

\KeywordTok{head}\NormalTok{(mat)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      N.stars    h  k k_2 k_3 epsilon delta phi tau Nt.vars N.jansen Nt.jansen
## [1,]      12 0.05 26 0.8 0.6     100     2   4   2    5940      220      5940
## [2,]      16 0.05 38 0.6 0.8      51     2   3   1   11568      297     11583
## [3,]       7 0.10 15 0.9 0.5     150     2   6   2     952       60       960
## [4,]       9 0.05 32 0.6 0.9     175     1   5   1    5481      166      5478
## [5,]      18 0.20  9 0.8 0.6      76     2   2   2     666       67       670
## [6,]      14 0.01 21 0.7 0.4     125     3   7   1   29120     1324     29128
\end{verbatim}

\hypertarget{the-model}{%
\section{The model}\label{the-model}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# DEFINE MODEL ---------------------------------------------------------------------}

\NormalTok{model_ti <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(N.stars, h, k, k_}\DecValTok{2}\NormalTok{, k_}\DecValTok{3}\NormalTok{, epsilon, delta, tau, phi, N.jansen, N.high) \{}
  \ControlFlowTok{if}\NormalTok{(tau }\OperatorTok{==}\StringTok{ }\DecValTok{1}\NormalTok{) \{}
\NormalTok{    method <-}\StringTok{ "R"}
\NormalTok{  \} }\ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{(tau }\OperatorTok{==}\StringTok{ }\DecValTok{2}\NormalTok{) \{}
\NormalTok{    method <-}\StringTok{ "QRN"}
\NormalTok{  \}}
  \CommentTok{# Create sample matrices}
  \KeywordTok{set.seed}\NormalTok{(epsilon)}
\NormalTok{  vars.matrix <-}\StringTok{ }\KeywordTok{vars_matrices}\NormalTok{(}\DataTypeTok{star.centers =}\NormalTok{ N.stars, }\DataTypeTok{params =} \KeywordTok{paste}\NormalTok{(}\StringTok{"X"}\NormalTok{, }\DecValTok{1}\OperatorTok{:}\NormalTok{k, }\DataTypeTok{sep =} \StringTok{""}\NormalTok{), }\DataTypeTok{h =}\NormalTok{ h, }
                               \DataTypeTok{method =}\NormalTok{ method)}
  \KeywordTok{set.seed}\NormalTok{(epsilon)}
\NormalTok{  jansen.matrix <-}\StringTok{ }\KeywordTok{sobol_matrices}\NormalTok{(}\DataTypeTok{matrices =} \KeywordTok{c}\NormalTok{(}\StringTok{"A"}\NormalTok{, }\StringTok{"AB"}\NormalTok{), }\DataTypeTok{N =}\NormalTok{ N.jansen, }
                                  \DataTypeTok{params =} \KeywordTok{paste}\NormalTok{(}\StringTok{"X"}\NormalTok{, }\DecValTok{1}\OperatorTok{:}\NormalTok{k, }\DataTypeTok{sep =} \StringTok{""}\NormalTok{))}
  \KeywordTok{set.seed}\NormalTok{(epsilon)}
\NormalTok{  large.matrix <-}\StringTok{ }\KeywordTok{sobol_matrices}\NormalTok{(}\DataTypeTok{matrices =} \KeywordTok{c}\NormalTok{(}\StringTok{"A"}\NormalTok{, }\StringTok{"AB"}\NormalTok{), }\DataTypeTok{N =}\NormalTok{ N.high, }
                                 \DataTypeTok{params =} \KeywordTok{paste}\NormalTok{(}\StringTok{"X"}\NormalTok{, }\DecValTok{1}\OperatorTok{:}\NormalTok{k, }\DataTypeTok{sep =} \StringTok{""}\NormalTok{), }
                                 \DataTypeTok{method =}\NormalTok{ method)}
  \CommentTok{# Compute metafunciton}
  \KeywordTok{set.seed}\NormalTok{(epsilon)}
\NormalTok{  output <-}\StringTok{ }\NormalTok{sensobol}\OperatorTok{::}\KeywordTok{metafunction}\NormalTok{(}\DataTypeTok{data =} \KeywordTok{random_distributions}\NormalTok{(}\DataTypeTok{X =} \KeywordTok{rbind}\NormalTok{(jansen.matrix, }
\NormalTok{                                                                         vars.matrix, }
\NormalTok{                                                                         large.matrix), }
                                                               \DataTypeTok{phi =}\NormalTok{ phi), }
                                   \DataTypeTok{k_2 =}\NormalTok{ k_}\DecValTok{2}\NormalTok{, }\DataTypeTok{k_3 =}\NormalTok{ k_}\DecValTok{3}\NormalTok{, }\DataTypeTok{epsilon =}\NormalTok{ epsilon)}
  \CommentTok{# Compute sobol' indices on a large sample size}
\NormalTok{  full.ind <-}\StringTok{ }\KeywordTok{jansen_ti}\NormalTok{(}\DataTypeTok{d =} \KeywordTok{tail}\NormalTok{(output, }\KeywordTok{nrow}\NormalTok{(large.matrix)), }
                        \DataTypeTok{N =}\NormalTok{ N.high, }
                        \DataTypeTok{params =} \KeywordTok{paste}\NormalTok{(}\StringTok{"X"}\NormalTok{, }\DecValTok{1}\OperatorTok{:}\NormalTok{k, }\DataTypeTok{sep =} \StringTok{""}\NormalTok{))}
\NormalTok{  full.ind[, sample.size}\OperatorTok{:}\ErrorTok{=}\StringTok{ "N"}\NormalTok{]}
  \CommentTok{# Define indices of Y for VARS}
\NormalTok{  lg.jansen <-}\StringTok{ }\DecValTok{1}\OperatorTok{:}\NormalTok{(N.jansen }\OperatorTok{*}\StringTok{ }\NormalTok{(k }\OperatorTok{+}\StringTok{ }\DecValTok{1}\NormalTok{))}
\NormalTok{  Nt.vars <-}\StringTok{ }\NormalTok{N.stars }\OperatorTok{*}\StringTok{ }\NormalTok{(k }\OperatorTok{*}\StringTok{ }\NormalTok{((}\DecValTok{1} \OperatorTok{/}\StringTok{ }\NormalTok{h) }\OperatorTok{-}\StringTok{ }\DecValTok{1}\NormalTok{) }\OperatorTok{+}\StringTok{ }\DecValTok{1}\NormalTok{)}
\NormalTok{  lg.vars <-}\StringTok{ }\NormalTok{(}\KeywordTok{max}\NormalTok{(lg.jansen) }\OperatorTok{+}\StringTok{ }\DecValTok{1}\NormalTok{)}\OperatorTok{:}\StringTok{ }\NormalTok{(}\KeywordTok{max}\NormalTok{(lg.jansen) }\OperatorTok{+}\StringTok{ }\NormalTok{Nt.vars)}
  \CommentTok{# Compute VARS}
\NormalTok{  ind.vars <-}\StringTok{ }\KeywordTok{vars_ti}\NormalTok{(output[lg.vars], }\DataTypeTok{star.centers =}\NormalTok{ N.stars, }
                      \DataTypeTok{params =} \KeywordTok{paste}\NormalTok{(}\StringTok{"X"}\NormalTok{, }\DecValTok{1}\OperatorTok{:}\NormalTok{k, }\DataTypeTok{sep =} \StringTok{""}\NormalTok{), }\DataTypeTok{h =}\NormalTok{ h) }\OperatorTok{%>%}
\StringTok{    }\NormalTok{.[, sample.size}\OperatorTok{:}\ErrorTok{=}\StringTok{ "n"}\NormalTok{]}
\NormalTok{  full.vars <-}\StringTok{ }\KeywordTok{rbind}\NormalTok{(ind.vars, full.ind)[, estimator}\OperatorTok{:}\ErrorTok{=}\StringTok{ "VARS-TO"}\NormalTok{]}
  \CommentTok{# Compute Jansen}
\NormalTok{  ind.jansen <-}\StringTok{ }\KeywordTok{jansen_ti}\NormalTok{(}\DataTypeTok{d =}\NormalTok{ output[lg.jansen], }\DataTypeTok{N =}\NormalTok{ N.jansen, }
                          \DataTypeTok{params =} \KeywordTok{paste}\NormalTok{(}\StringTok{"X"}\NormalTok{, }\DecValTok{1}\OperatorTok{:}\NormalTok{k, }\DataTypeTok{sep =} \StringTok{""}\NormalTok{))}
\NormalTok{  ind.jansen[, sample.size}\OperatorTok{:}\ErrorTok{=}\StringTok{ "n"}\NormalTok{]}
\NormalTok{  full.jansen <-}\StringTok{ }\KeywordTok{rbind}\NormalTok{(ind.jansen, full.ind)[, estimator}\OperatorTok{:}\ErrorTok{=}\StringTok{ "Jansen"}\NormalTok{]}
\NormalTok{  out <-}\StringTok{ }\KeywordTok{rbind}\NormalTok{(full.vars, full.jansen)}
\NormalTok{  out.wide <-}\StringTok{ }\KeywordTok{dcast}\NormalTok{(out, estimator }\OperatorTok{+}\StringTok{ }\NormalTok{parameters }\OperatorTok{~}\StringTok{ }\NormalTok{sample.size, }\DataTypeTok{value.var =} \StringTok{"Ti"}\NormalTok{)}
  \CommentTok{# Replace NaN}
  \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \KeywordTok{seq_along}\NormalTok{(out.wide)) }
    \KeywordTok{set}\NormalTok{(out.wide, }\DataTypeTok{i=}\KeywordTok{which}\NormalTok{(}\KeywordTok{is.nan}\NormalTok{(out.wide[[i]])), }\DataTypeTok{j =}\NormalTok{ i, }\DataTypeTok{value =} \DecValTok{0}\NormalTok{)}
  \CommentTok{# Replace Inf}
  \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \KeywordTok{seq_along}\NormalTok{(out.wide)) }
    \KeywordTok{set}\NormalTok{(out.wide, }\DataTypeTok{i=}\KeywordTok{which}\NormalTok{(}\KeywordTok{is.infinite}\NormalTok{(out.wide[[i]])), }\DataTypeTok{j =}\NormalTok{ i, }\DataTypeTok{value =} \DecValTok{0}\NormalTok{)}
  \CommentTok{# Replcace Na}
  \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \KeywordTok{seq_along}\NormalTok{(out.wide)) }
    \KeywordTok{set}\NormalTok{(out.wide, }\DataTypeTok{i=}\KeywordTok{which}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(out.wide[[i]])), }\DataTypeTok{j =}\NormalTok{ i, }\DataTypeTok{value =} \DecValTok{0}\NormalTok{)}
  \CommentTok{# CHECK DELTA}
  \ControlFlowTok{if}\NormalTok{(delta }\OperatorTok{==}\StringTok{ }\DecValTok{1}\NormalTok{) \{ }\CommentTok{# Regular Pear}
\NormalTok{    final <-}\StringTok{ }\NormalTok{out.wide[, .(}\DataTypeTok{correlation =} \KeywordTok{cor}\NormalTok{(N, n)), estimator]}
\NormalTok{  \} }\ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{(delta }\OperatorTok{==}\StringTok{ }\DecValTok{2}\NormalTok{) \{ }\CommentTok{# kendall tau}
\NormalTok{    final <-}\StringTok{ }\NormalTok{out.wide[, .(}\DataTypeTok{correlation =}\NormalTok{ pcaPP}\OperatorTok{::}\KeywordTok{cor.fk}\NormalTok{(N, n)), estimator]}
\NormalTok{  \} }\ControlFlowTok{else}\NormalTok{ \{ }\CommentTok{# Savage ranks}
\NormalTok{    final <-}\StringTok{ }\NormalTok{out.wide[, }\KeywordTok{lapply}\NormalTok{(.SD, savage_scores), .SDcols =}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"N"}\NormalTok{, }\StringTok{"n"}\NormalTok{), estimator][}
\NormalTok{      , .(}\DataTypeTok{correlation =} \KeywordTok{cor}\NormalTok{(N, n)), estimator]}
\NormalTok{  \}}
  \KeywordTok{return}\NormalTok{(final)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# RUN MODEL -----------------------------------------------------------------------}

\CommentTok{# Define parallel computing}
\NormalTok{cl <-}\StringTok{ }\KeywordTok{makeCluster}\NormalTok{(n_cores)}
\KeywordTok{registerDoParallel}\NormalTok{(cl)}

\CommentTok{# Compute}
\NormalTok{Y.ti <-}\StringTok{ }\KeywordTok{foreach}\NormalTok{(}\DataTypeTok{i=}\DecValTok{1}\OperatorTok{:}\KeywordTok{nrow}\NormalTok{(mat), }
                \DataTypeTok{.packages =} \KeywordTok{c}\NormalTok{(}\StringTok{"sensobol"}\NormalTok{, }\StringTok{"data.table"}\NormalTok{, }\StringTok{"dplyr"}\NormalTok{, }
                              \StringTok{"pcaPP"}\NormalTok{, }\StringTok{"logitnorm"}\NormalTok{)) }\OperatorTok{%dopar%}
\StringTok{  }\NormalTok{\{}
    \KeywordTok{model_ti}\NormalTok{(}\DataTypeTok{N.stars =}\NormalTok{ mat[[i, }\StringTok{"N.stars"}\NormalTok{]], }
             \DataTypeTok{h =}\NormalTok{ mat[[i, }\StringTok{"h"}\NormalTok{]], }
             \DataTypeTok{k =}\NormalTok{ mat[[i, }\StringTok{"k"}\NormalTok{]], }
             \DataTypeTok{k_2 =}\NormalTok{ mat[[i, }\StringTok{"k_2"}\NormalTok{]], }
             \DataTypeTok{k_3 =}\NormalTok{ mat[[i, }\StringTok{"k_3"}\NormalTok{]],}
             \DataTypeTok{epsilon =}\NormalTok{ mat[[i, }\StringTok{"epsilon"}\NormalTok{]],}
             \DataTypeTok{delta =}\NormalTok{ mat[[i, }\StringTok{"delta"}\NormalTok{]], }
             \DataTypeTok{phi =}\NormalTok{ mat[[i, }\StringTok{"phi"}\NormalTok{]],}
             \DataTypeTok{tau =}\NormalTok{ mat[[i, }\StringTok{"tau"}\NormalTok{]],}
             \DataTypeTok{N.jansen =}\NormalTok{ mat[[i, }\StringTok{"N.jansen"}\NormalTok{]], }
             \DataTypeTok{N.high =}\NormalTok{ N.high)}
\NormalTok{  \}}

\CommentTok{# Stop parallel cluster}
\KeywordTok{stopCluster}\NormalTok{(cl)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# ARRANGE OUTPUT -----------------------------------------------------------------}

\NormalTok{out_cor <-}\StringTok{ }\KeywordTok{rbindlist}\NormalTok{(Y.ti, }\DataTypeTok{idcol =} \StringTok{"row"}\NormalTok{)}

\NormalTok{mt.dt <-}\StringTok{ }\KeywordTok{data.table}\NormalTok{(mat) }\OperatorTok{%>%}
\StringTok{  }\NormalTok{.[, row}\OperatorTok{:}\ErrorTok{=}\StringTok{ }\DecValTok{1}\OperatorTok{:}\NormalTok{.N]}

\NormalTok{full_output <-}\StringTok{ }\KeywordTok{merge}\NormalTok{(mt.dt, out_cor) }\OperatorTok{%>%}
\StringTok{  }\NormalTok{.[, Nt}\OperatorTok{:}\ErrorTok{=}\StringTok{ }\KeywordTok{ifelse}\NormalTok{(estimator }\OperatorTok{==}\StringTok{ "VARS-TO"}\NormalTok{, Nt.vars, Nt.jansen)]}

\CommentTok{# Show rows with NA or NaN}
\NormalTok{full_output[}\KeywordTok{is.na}\NormalTok{(correlation), ]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##        row N.stars    h  k k_2 k_3 epsilon delta phi tau Nt.vars N.jansen
##   1:    42      20 0.05  5 0.7 0.9     166     2   2   2    1920      320
##   2:   369      13 0.10  6 1.0 0.7      72     3   2   2     715      102
##   3:  1087       3 0.10 10 0.5 0.5      67     2   2   2     273       25
##   4:  1386      20 0.05  5 0.6 0.7      60     3   2   2    1920      320
##   5:  1507       8 0.10  6 0.8 1.0     113     1   2   2     440       63
##  ---                                                                     
## 157: 44333      18 0.10  3 0.5 0.6      27     2   2   2     504      126
## 158: 44621      17 0.10  7 0.6 0.9     165     1   2   2    1088      136
## 159: 44782      13 0.05  3 0.8 0.6     173     2   2   2     754      188
## 160: 44782      13 0.05  3 0.8 0.6     173     2   2   2     754      188
## 161: 44819       9 0.10 10 0.5 1.0      48     3   2   2     819       74
##      Nt.jansen estimator correlation   Nt
##   1:      1920   VARS-TO         NaN 1920
##   2:       714   VARS-TO          NA  715
##   3:       275   VARS-TO         NaN  273
##   4:      1920   VARS-TO          NA 1920
##   5:       441   VARS-TO          NA  440
##  ---                                     
## 157:       504   VARS-TO         NaN  504
## 158:      1088   VARS-TO          NA 1088
## 159:       752    Jansen         NaN  752
## 160:       752   VARS-TO         NaN  754
## 161:       814   VARS-TO          NA  819
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Compute proportion of rows with Na or NaN}
\NormalTok{full_output[, }\KeywordTok{sum}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(correlation)) }\OperatorTok{/}\StringTok{ }\NormalTok{.N, estimator]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    estimator           V1
## 1:    Jansen 0.0007324219
## 2:   VARS-TO 0.0028409091
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Substitute NA by 0}
\NormalTok{full_output <-}\StringTok{ }\NormalTok{full_output[, correlation}\OperatorTok{:}\ErrorTok{=}\StringTok{ }\KeywordTok{ifelse}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(correlation) }\OperatorTok{==}\StringTok{ }\OtherTok{TRUE}\NormalTok{, }\DecValTok{0}\NormalTok{, correlation)]}

\NormalTok{A <-}\StringTok{ }\NormalTok{full_output[,.SD[}\DecValTok{1}\OperatorTok{:}\NormalTok{N], estimator][, ratio}\OperatorTok{:}\ErrorTok{=}\StringTok{ }\NormalTok{Nt }\OperatorTok{/}\StringTok{ }\NormalTok{k]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# EXPORT RESULTS -----------------------------------------------------------------}

\KeywordTok{fwrite}\NormalTok{(A, }\StringTok{"A.csv"}\NormalTok{)}
\KeywordTok{fwrite}\NormalTok{(full_output, }\StringTok{"full_output.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{uncertainty-analysis}{%
\section{Uncertainty analysis}\label{uncertainty-analysis}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# UNCERTAINTY ANALYSIS -----------------------------------------------------------}

\CommentTok{# Compute median and quantiles}
\NormalTok{dt_median <-}\StringTok{ }\NormalTok{A[, .(}\DataTypeTok{median =} \KeywordTok{median}\NormalTok{(correlation), }
                   \DataTypeTok{low.ci =} \KeywordTok{quantile}\NormalTok{(correlation, }\FloatTok{0.25}\NormalTok{), }
                   \DataTypeTok{high.ci =} \KeywordTok{quantile}\NormalTok{(correlation, }\FloatTok{0.75}\NormalTok{)), estimator]}

\NormalTok{A[, .(}\DataTypeTok{median =} \KeywordTok{median}\NormalTok{(correlation), }
      \DataTypeTok{low.ci =} \KeywordTok{quantile}\NormalTok{(correlation, }\FloatTok{0.25}\NormalTok{), }
      \DataTypeTok{high.ci =} \KeywordTok{quantile}\NormalTok{(correlation, }\FloatTok{0.75}\NormalTok{)), estimator][}\KeywordTok{order}\NormalTok{(median)]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    estimator    median    low.ci   high.ci
## 1:   VARS-TO 0.9503634 0.8740740 0.9905648
## 2:    Jansen 0.9826840 0.9354839 0.9985708
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# PLOT UNCERTAINTY ---------------------------------------------------------------}

\CommentTok{# Histograms}
\NormalTok{unc <-}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(A, }\KeywordTok{aes}\NormalTok{(correlation)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_rect}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ dt_median,}
            \KeywordTok{aes}\NormalTok{(}\DataTypeTok{xmin =}\NormalTok{ low.ci,}
                \DataTypeTok{xmax =}\NormalTok{ high.ci,}
                \DataTypeTok{ymin =} \OperatorTok{-}\OtherTok{Inf}\NormalTok{,}
                \DataTypeTok{ymax =} \OtherTok{Inf}\NormalTok{),}
            \DataTypeTok{fill =} \StringTok{"blue"}\NormalTok{,}
            \DataTypeTok{color =} \StringTok{"white"}\NormalTok{,}
            \DataTypeTok{alpha =} \FloatTok{0.1}\NormalTok{,}
            \DataTypeTok{inherit.aes =} \OtherTok{FALSE}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_histogram}\NormalTok{() }\OperatorTok{+}\StringTok{ }
\StringTok{  }\KeywordTok{geom_vline}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ dt_median, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{xintercept =}\NormalTok{ median), }
             \DataTypeTok{lty =} \DecValTok{2}\NormalTok{, }
             \DataTypeTok{color =} \StringTok{"red"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{facet_wrap}\NormalTok{(}\OperatorTok{~}\NormalTok{estimator, }
             \DataTypeTok{ncol =} \DecValTok{4}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale_x_continuous}\NormalTok{(}\DataTypeTok{breaks =} \KeywordTok{pretty_breaks}\NormalTok{(}\DataTypeTok{n =} \DecValTok{3}\NormalTok{)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale_y_continuous}\NormalTok{(}\DataTypeTok{breaks =} \KeywordTok{pretty_breaks}\NormalTok{(}\DataTypeTok{n =} \DecValTok{3}\NormalTok{)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{x =} \KeywordTok{expression}\NormalTok{(}\KeywordTok{italic}\NormalTok{(r)), }
       \DataTypeTok{y =} \StringTok{"Counts"}\NormalTok{) }\OperatorTok{+}\StringTok{ }
\StringTok{  }\KeywordTok{theme_AP}\NormalTok{() }

\NormalTok{unc}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
\end{verbatim}

\begin{figure}
\centering
\includegraphics{code_vars_design_files/figure-latex/histograms-1.pdf}
\caption{Empirical distribution of \(r\) for Jansen and VARS.}
\end{figure}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# SCATTERPLOT OF MODEL RESULTS ---------------------------------------------------}

\NormalTok{scat <-}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(A, }\KeywordTok{aes}\NormalTok{(Nt, k, }\DataTypeTok{color =}\NormalTok{ correlation)) }\OperatorTok{+}\StringTok{ }
\StringTok{  }\KeywordTok{geom_point}\NormalTok{(}\DataTypeTok{size =} \FloatTok{0.4}\NormalTok{) }\OperatorTok{+}\StringTok{ }
\StringTok{  }\KeywordTok{scale_colour_gradientn}\NormalTok{(}\DataTypeTok{colours =} \KeywordTok{c}\NormalTok{(}\StringTok{"black"}\NormalTok{, }\StringTok{"purple"}\NormalTok{, }\StringTok{"red"}\NormalTok{, }\StringTok{"orange"}\NormalTok{, }\StringTok{"lightgreen"}\NormalTok{), }
                         \DataTypeTok{name =} \KeywordTok{expression}\NormalTok{(}\KeywordTok{italic}\NormalTok{(r)),                }
                         \DataTypeTok{breaks =} \KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\FloatTok{0.5}\NormalTok{, }\DecValTok{1}\NormalTok{)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale_x_log10}\NormalTok{(}\DataTypeTok{breaks =}\NormalTok{ scales}\OperatorTok{::}\KeywordTok{trans_breaks}\NormalTok{(}\StringTok{"log10"}\NormalTok{, }\ControlFlowTok{function}\NormalTok{(x) }\DecValTok{10} \OperatorTok{^}\StringTok{ }\NormalTok{(}\DecValTok{2} \OperatorTok{*}\StringTok{ }\NormalTok{x)),}
               \DataTypeTok{labels =}\NormalTok{ scales}\OperatorTok{::}\KeywordTok{trans_format}\NormalTok{(}\StringTok{"log10"}\NormalTok{, scales}\OperatorTok{::}\KeywordTok{math_format}\NormalTok{(}\DecValTok{10}\OperatorTok{^}\NormalTok{.x))) }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale_y_continuous}\NormalTok{(}\DataTypeTok{breaks =} \KeywordTok{pretty_breaks}\NormalTok{(}\DataTypeTok{n =} \DecValTok{3}\NormalTok{)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{x =} \KeywordTok{expression}\NormalTok{(}\KeywordTok{italic}\NormalTok{(N[t])), }
       \DataTypeTok{y =} \KeywordTok{expression}\NormalTok{(}\KeywordTok{italic}\NormalTok{(k))) }\OperatorTok{+}\StringTok{ }
\StringTok{  }\KeywordTok{facet_wrap}\NormalTok{(}\OperatorTok{~}\NormalTok{estimator,}
             \DataTypeTok{ncol =} \DecValTok{4}\NormalTok{) }\OperatorTok{+}\StringTok{ }
\StringTok{  }\KeywordTok{theme_AP}\NormalTok{() }\OperatorTok{+}\StringTok{ }
\StringTok{  }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{legend.position =} \StringTok{"top"}\NormalTok{)}

\NormalTok{scat}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{code_vars_design_files/figure-latex/scatter_uncertain-1.pdf}
\caption{Scatterplots of the total number of model runs \(N_t\) against
the function dimensionality \(k\). The greener (darker) the colour, the
better (worse) the performance.}
\end{figure}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# MERGE PLOTS ---------------------------------------------------------------------}
 
\KeywordTok{plot_grid}\NormalTok{(unc, scat, }\DataTypeTok{ncol =} \DecValTok{1}\NormalTok{, }\DataTypeTok{labels =} \StringTok{"auto"}\NormalTok{, }\DataTypeTok{align =} \StringTok{"hv"}\NormalTok{, }
          \DataTypeTok{rel_heights =} \KeywordTok{c}\NormalTok{(}\FloatTok{0.72}\NormalTok{, }\DecValTok{1}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
\end{verbatim}

\begin{verbatim}
## Warning: Graphs cannot be horizontally aligned unless the axis parameter is set.
## Placing graphs unaligned.
\end{verbatim}

\includegraphics{code_vars_design_files/figure-latex/merge_plots-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# PLOT R MEDIANS AS FUNCTION OF K AND NT/K ---------------------------------------}

\NormalTok{vv <-}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DecValTok{50}\NormalTok{, }\DecValTok{5}\NormalTok{)}

\NormalTok{dt <-}\StringTok{ }\KeywordTok{lapply}\NormalTok{(vv, }\ControlFlowTok{function}\NormalTok{(x) A[k }\OperatorTok{<=}\StringTok{ }\NormalTok{x, }\KeywordTok{median}\NormalTok{(correlation), estimator])}

\KeywordTok{names}\NormalTok{(dt) <-}\StringTok{ }\NormalTok{vv}

\CommentTok{# Plot r as a function of k}
\NormalTok{a1 <-}\StringTok{ }\KeywordTok{rbindlist}\NormalTok{(dt, }\DataTypeTok{idcol =} \StringTok{"k"}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\NormalTok{.[, k}\OperatorTok{:}\ErrorTok{=}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(k)] }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(., }\KeywordTok{aes}\NormalTok{(k, V1, }\DataTypeTok{color =}\NormalTok{ estimator)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale_color_discrete}\NormalTok{(}\DataTypeTok{name =} \StringTok{"Estimator"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{x =} \KeywordTok{expression}\NormalTok{(}\KeywordTok{italic}\NormalTok{(k)), }
       \DataTypeTok{y =} \KeywordTok{expression}\NormalTok{(}\KeywordTok{median}\NormalTok{(}\KeywordTok{italic}\NormalTok{(r)))) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_line}\NormalTok{() }\OperatorTok{+}\StringTok{ }
\StringTok{  }\KeywordTok{theme_AP}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{legend.position =} \StringTok{"none"}\NormalTok{)}

\CommentTok{# Median Nt/k}
\NormalTok{dt.tmp <-}\StringTok{ }\NormalTok{A[, .(}\DataTypeTok{min =} \KeywordTok{min}\NormalTok{(ratio), }\DataTypeTok{max =} \KeywordTok{max}\NormalTok{(ratio))]}

\NormalTok{v <-}\StringTok{  }\KeywordTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{, }\KeywordTok{ceiling}\NormalTok{(dt.tmp}\OperatorTok{$}\NormalTok{max), }\DecValTok{20}\NormalTok{)}
\NormalTok{a <-}\StringTok{ }\KeywordTok{c}\NormalTok{(v[}\DecValTok{1}\NormalTok{], }\KeywordTok{rep}\NormalTok{(v[}\OperatorTok{-}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\KeywordTok{length}\NormalTok{(v))], }\DataTypeTok{each =} \DecValTok{2}\NormalTok{), v[}\KeywordTok{length}\NormalTok{(v)])}
\NormalTok{indices <-}\StringTok{ }\KeywordTok{matrix}\NormalTok{(a, }\DataTypeTok{ncol =} \DecValTok{2}\NormalTok{, }\DataTypeTok{byrow =} \OtherTok{TRUE}\NormalTok{)}

\NormalTok{out <-}\StringTok{ }\KeywordTok{list}\NormalTok{()}
\ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{nrow}\NormalTok{(indices)) \{}
\NormalTok{  out[[i]] <-}\StringTok{ }\NormalTok{A[ratio }\OperatorTok{>}\StringTok{ }\NormalTok{indices[i, }\DecValTok{1}\NormalTok{] }\OperatorTok{&}\StringTok{ }\NormalTok{ratio }\OperatorTok{<}\StringTok{ }\NormalTok{indices[i, }\DecValTok{2}\NormalTok{]]}
\NormalTok{\}}

\KeywordTok{names}\NormalTok{(out) <-}\StringTok{ }\NormalTok{Rfast}\OperatorTok{::}\KeywordTok{rowmeans}\NormalTok{(indices)}

\CommentTok{# Plot r as a function of Nt/k}
\NormalTok{a2 <-}\StringTok{ }\KeywordTok{lapply}\NormalTok{(out, }\ControlFlowTok{function}\NormalTok{(x) x[, }\KeywordTok{median}\NormalTok{(correlation, }\DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{), estimator]) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{rbindlist}\NormalTok{(., }\DataTypeTok{idcol =} \StringTok{"N"}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\NormalTok{.[, N}\OperatorTok{:}\ErrorTok{=}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(N)] }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(., }\KeywordTok{aes}\NormalTok{(N, V1, }\DataTypeTok{group =}\NormalTok{ estimator, }\DataTypeTok{color =}\NormalTok{ estimator)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_line}\NormalTok{() }\OperatorTok{+}\StringTok{ }
\StringTok{  }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{x =} \KeywordTok{expression}\NormalTok{(}\KeywordTok{italic}\NormalTok{(N[t]}\OperatorTok{/}\NormalTok{k)),}
       \DataTypeTok{y =} \StringTok{""}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale_color_discrete}\NormalTok{(}\DataTypeTok{name =} \StringTok{"Estimator"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale_x_log10}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\KeywordTok{theme_AP}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{legend.position =} \StringTok{"none"}\NormalTok{)}

\CommentTok{# Merge both plots}
\NormalTok{legend <-}\StringTok{ }\KeywordTok{get_legend}\NormalTok{(a1 }\OperatorTok{+}\StringTok{ }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{legend.position =} \StringTok{"top"}\NormalTok{))}
\NormalTok{sides <-}\StringTok{ }\KeywordTok{plot_grid}\NormalTok{(a1, a2, }\DataTypeTok{ncol =} \DecValTok{2}\NormalTok{, }\DataTypeTok{rel_widths =} \KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{), }\DataTypeTok{align =} \StringTok{"hv"}\NormalTok{, }
                   \DataTypeTok{labels =} \StringTok{"auto"}\NormalTok{)}

\KeywordTok{plot_grid}\NormalTok{(legend, sides, }\DataTypeTok{rel_heights =} \KeywordTok{c}\NormalTok{(}\FloatTok{0.2}\NormalTok{, }\DecValTok{1}\NormalTok{), }\DataTypeTok{ncol =} \DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{code_vars_design_files/figure-latex/median_ratios-1.pdf}

\hypertarget{sensitivity-analysis}{%
\section{Sensitivity analysis}\label{sensitivity-analysis}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# SCATTERPLOTS -------------------------------------------------------------------}

\NormalTok{params_notikz <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"N[stars]"}\NormalTok{, }\StringTok{"h"}\NormalTok{, }\StringTok{"k"}\NormalTok{, }\StringTok{"k[2]"}\NormalTok{, }\StringTok{"k[3]"}\NormalTok{, }
                   \StringTok{"epsilon"}\NormalTok{, }\StringTok{"delta"}\NormalTok{, }\StringTok{"phi"}\NormalTok{, }\StringTok{"tau"}\NormalTok{) }

\CommentTok{# Scatterplot of model inputs against output}
\NormalTok{A[estimator }\OperatorTok{==}\StringTok{ "VARS-TO"}\NormalTok{] }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{setnames}\NormalTok{(., params, params_notikz) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{melt}\NormalTok{(., }\DataTypeTok{measure.vars =}\NormalTok{ params_notikz) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(., }\KeywordTok{aes}\NormalTok{(value, correlation)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{(}\DataTypeTok{size =} \FloatTok{0.5}\NormalTok{, }\DataTypeTok{alpha =} \FloatTok{0.1}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{facet_wrap}\NormalTok{(}\OperatorTok{~}\NormalTok{variable, }
             \DataTypeTok{scales =} \StringTok{"free_x"}\NormalTok{, }
             \DataTypeTok{labeller =}\NormalTok{ label_parsed) }\OperatorTok{+}
\StringTok{  }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{y =} \KeywordTok{expression}\NormalTok{(}\KeywordTok{italic}\NormalTok{(r)), }
       \DataTypeTok{x =} \StringTok{""}\NormalTok{) }\OperatorTok{+}\StringTok{ }
\StringTok{  }\KeywordTok{theme_AP}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{code_vars_design_files/figure-latex/scatterplots-1.pdf}
\caption{Scatterplots of model output \(r\) against the model inputs.}
\end{figure}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# SOBOL' INDICES -------------------------------------------------------------------}

\NormalTok{params_tikz <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"$N_\{stars\}$"}\NormalTok{, }\StringTok{"$h$"}\NormalTok{, }\StringTok{"$k$"}\NormalTok{, }\StringTok{"$k_2$"}\NormalTok{, }\StringTok{"$k_3$"}\NormalTok{, }\StringTok{"$}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{epsilon$"}\NormalTok{, }
                 \StringTok{"$}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{delta$"}\NormalTok{, }\StringTok{"$}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{phi$"}\NormalTok{, }\StringTok{"$}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{tau$"}\NormalTok{)}

 \CommentTok{# Compute Sobol' indices except for the cluster Nt,k}
\NormalTok{indices <-}\StringTok{ }\NormalTok{full_output[, }\KeywordTok{sobol_indices}\NormalTok{(}\DataTypeTok{Y =}\NormalTok{ correlation, }
                                       \DataTypeTok{N =}\NormalTok{ N,}
                                       \DataTypeTok{params =}\NormalTok{ params_tikz,}
                                       \DataTypeTok{first =} \StringTok{"jansen"}\NormalTok{,}
                                       \DataTypeTok{boot =} \OtherTok{TRUE}\NormalTok{,}
                                       \DataTypeTok{R =}\NormalTok{ R,}
                                       \DataTypeTok{order =}\NormalTok{ order), }
\NormalTok{                       estimator]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# PLOT SOBOL' INDICES -------------------------------------------------------------}

\NormalTok{indices[sensitivity }\OperatorTok{==}\StringTok{ "Si"} \OperatorTok{|}\StringTok{ }\NormalTok{sensitivity }\OperatorTok{==}\StringTok{ "Ti"}\NormalTok{] }\OperatorTok{%>%}
\StringTok{  }\NormalTok{.[estimator }\OperatorTok{==}\StringTok{ "VARS-TO"}\NormalTok{] }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(., }\KeywordTok{aes}\NormalTok{(parameters, original, }\DataTypeTok{fill =}\NormalTok{ sensitivity)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_bar}\NormalTok{(}\DataTypeTok{stat =} \StringTok{"identity"}\NormalTok{, }
           \DataTypeTok{position =} \KeywordTok{position_dodge}\NormalTok{(}\FloatTok{0.6}\NormalTok{), }
           \DataTypeTok{color =} \StringTok{"black"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_errorbar}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{ymin =}\NormalTok{ low.ci, }
                    \DataTypeTok{ymax =}\NormalTok{ high.ci), }
                \DataTypeTok{position =} \KeywordTok{position_dodge}\NormalTok{(}\FloatTok{0.6}\NormalTok{)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale_y_continuous}\NormalTok{(}\DataTypeTok{breaks =} \KeywordTok{pretty_breaks}\NormalTok{(}\DataTypeTok{n =} \DecValTok{3}\NormalTok{)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{x =} \StringTok{""}\NormalTok{, }
       \DataTypeTok{y =} \StringTok{"Sobol' index"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale_fill_discrete}\NormalTok{(}\DataTypeTok{name =} \StringTok{"Sobol' indices"}\NormalTok{, }
                      \DataTypeTok{labels =} \KeywordTok{c}\NormalTok{(}\KeywordTok{expression}\NormalTok{(S[}\KeywordTok{italic}\NormalTok{(i)]), }
                                 \KeywordTok{expression}\NormalTok{(T[}\KeywordTok{italic}\NormalTok{(i)]))) }\OperatorTok{+}
\StringTok{  }\KeywordTok{theme_AP}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{legend.position =} \StringTok{"top"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{code_vars_design_files/figure-latex/plot_sobol-1.pdf}
\caption{Sobol' indices.}
\end{figure}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# SUM OF FIRST-ORDER INDICES -------------------------------------------------------}

\NormalTok{indices[sensitivity }\OperatorTok{==}\StringTok{ "Si"}\NormalTok{, }\KeywordTok{sum}\NormalTok{(original)]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.5780782
\end{verbatim}

\newpage

\hypertarget{session-information}{%
\section{Session information}\label{session-information}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# SESSION INFORMATION ---------------------------------------------------------------}

\KeywordTok{sessionInfo}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## R version 3.6.3 (2020-02-29)
## Platform: x86_64-apple-darwin15.6.0 (64-bit)
## Running under: macOS Catalina 10.15.5
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/3.6/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/3.6/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] parallel  stats     graphics  grDevices utils     datasets  methods  
## [8] base     
## 
## other attached packages:
##  [1] truncnorm_1.0-8    data.table_1.12.8  checkpoint_0.4.9   Rfast_1.9.9       
##  [5] RcppZiggurat_0.1.5 Rcpp_1.0.5         benchmarkme_1.0.4  logitnorm_0.8.37  
##  [9] cowplot_1.0.0      scales_1.1.1       pcaPP_1.9-73       doParallel_1.0.15 
## [13] iterators_1.0.12   foreach_1.5.0      sensobol_0.3       forcats_0.5.0     
## [17] stringr_1.4.0      dplyr_1.0.0        purrr_0.3.4        readr_1.3.1       
## [21] tidyr_1.1.0        tibble_3.0.3       ggplot2_3.3.2      tidyverse_1.3.0   
## 
## loaded via a namespace (and not attached):
##  [1] httr_1.4.2            jsonlite_1.7.0        modelr_0.1.8         
##  [4] Rdpack_1.0.0          assertthat_0.2.1      highr_0.8            
##  [7] tikzDevice_0.12.3.1   blob_1.2.1            cellranger_1.1.0     
## [10] yaml_2.2.1            remotes_2.2.0         pillar_1.4.6         
## [13] backports_1.1.8       lattice_0.20-41       glue_1.4.1           
## [16] digest_0.6.25         rvest_0.3.6           colorspace_1.4-1     
## [19] htmltools_0.5.0       Matrix_1.2-18         pkgconfig_2.0.3      
## [22] bibtex_0.4.2.2        broom_0.7.0           haven_2.3.1          
## [25] mvtnorm_1.1-1         farver_2.0.3          generics_0.0.2       
## [28] ellipsis_0.3.1        withr_2.2.0           cli_2.0.2            
## [31] magrittr_1.5          crayon_1.3.4          readxl_1.3.1         
## [34] evaluate_0.14         fs_1.4.2              fansi_0.4.1          
## [37] xml2_1.3.2            tools_3.6.3           hms_0.5.3            
## [40] gbRd_0.4-11           lifecycle_0.2.0       munsell_0.5.0        
## [43] reprex_0.3.0          compiler_3.6.3        tinytex_0.25         
## [46] rlang_0.4.7           grid_3.6.3            rstudioapi_0.11      
## [49] filehash_2.4-2        rmarkdown_2.3         gtable_0.3.0         
## [52] codetools_0.2-16      DBI_1.1.0             curl_4.3             
## [55] benchmarkmeData_1.0.4 R6_2.4.1              lubridate_1.7.9      
## [58] knitr_1.29            stringi_1.4.6         vctrs_0.3.2          
## [61] dbplyr_1.4.4          tidyselect_1.1.0      xfun_0.16
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{## Return the machine CPU}
\KeywordTok{cat}\NormalTok{(}\StringTok{"Machine:     "}\NormalTok{); }\KeywordTok{print}\NormalTok{(}\KeywordTok{get_cpu}\NormalTok{()}\OperatorTok{$}\NormalTok{model_name)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Machine:
\end{verbatim}

\begin{verbatim}
## [1] "Intel(R) Core(TM) i9-9900K CPU @ 3.60GHz"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{## Return number of true cores}
\KeywordTok{cat}\NormalTok{(}\StringTok{"Num cores:   "}\NormalTok{); }\KeywordTok{print}\NormalTok{(}\KeywordTok{detectCores}\NormalTok{(}\DataTypeTok{logical =} \OtherTok{FALSE}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Num cores:
\end{verbatim}

\begin{verbatim}
## [1] 8
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{## Return number of threads}
\KeywordTok{cat}\NormalTok{(}\StringTok{"Num threads: "}\NormalTok{); }\KeywordTok{print}\NormalTok{(}\KeywordTok{detectCores}\NormalTok{(}\DataTypeTok{logical =} \OtherTok{FALSE}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Num threads:
\end{verbatim}

\begin{verbatim}
## [1] 8
\end{verbatim}

\end{document}
